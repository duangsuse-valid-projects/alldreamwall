<!DOCTYPE html>
<!-- Copyright(C) 2018 duangsuse
alldream.html is a standalone web fortend tool for viewing alldream workshare platform worklist
Licensed under LGPLv3 -->
<html lang="zh-cn" dir="ltr">

<head>
  <title>AllDream å‚²æ¢¦å±•è§ˆå¢™</title>
  <meta charset="utf-8">
  <meta name="description" content="æ¬£èµ 4k+ ä¸ªä¸­å›½å­©å­çš„ç¥å¥‡ä½œå“">
  <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta property="og:site_name" content="å‚²æ¢¦ç¼–ç¨‹ BigWall">
  <meta property="og:title" content="å‚²æ¢¦ç¼–ç¨‹ BigWall">
  <meta property="og:description" content="æ¬£èµ 4k+ ä¸ªå­©å­çš„ç¥å¥‡ä½œå“">
  <meta name="theme-color" content="#2196F3">
  <!-- MDUI <3 duangsuse -->
  <link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/mdui/0.4.1/css/mdui.min.css">
  <script src="https://cdnjs.loli.net/ajax/libs/mdui/0.4.1/js/mdui.min.js"></script>
  <script src="https://cdnjs.loli.net/ajax/libs/downloadjs/1.4.8/download.js"></script>
  <script>
    var $$ = mdui.JQ;
    localStorage['page'] = localStorage['page'] || 25
    localStorage['cate'] = localStorage['cate'] || 'scratch'
    function s(set) { localStorage['cate'] = set; $$('#title')[0].text = "ä½œå“ç›®å½•" + "ï¼ˆ" + set + "ï¼‰" }
  </script>
</head>

<body class="mdui-theme-primary-blue mdui-theme-accent-pink">
  <div class="mdui-appbar">
    <div class="mdui-toolbar mdui-color-theme">
      <a id="title" class="mdui-typo-title" mdui-tooltip="{content: 'æ˜¾ç¤ºä½œå“è®¡æ•°'}">ä½œå“ç›®å½•</a>
      <div class="mdui-toolbar-spacer"></div>
      <a onclick="if (pageNum > 1) { pageNum--; mdui.snackbar('åé€€ä¸€é¡µï¼š' + pageNum) } else { mdui.snackbar('åˆ°ç¬¬ä¸€é¡µäº†') }" class="mdui-btn mdui-btn-icon"
        mdui-tooltip="{content: 'åé€€ä¸€é¡µ'}">
        <i class="mdui-icon material-icons">arrow_back</i>
      </a>
      <a id="pagnum" class="mdui-btn mdui-btn-icon" mdui-tooltip="{content: 'æ¯é¡µé¢æ˜¾ç¤ºæ¡æ•°'}">
        <i class="mdui-icon material-icons">featured_play_list</i>
      </a>
      <a class="mdui-btn mdui-btn-icon" mdui-dialog="{target: '#set-category'}" mdui-tooltip="{content: 'åˆ†ç±»'}">
        <i class="mdui-icon material-icons">folder</i>
      </a>
      <a id="refresh" class="mdui-btn mdui-btn-icon" mdui-tooltip="{content: 'åˆ·æ–°'}">
        <i class="mdui-icon material-icons">refresh</i>
      </a>
    </div>
  </div>

  <script>
    function mapSid(name) {
      if (name == 'scratch')
        return 1
      else if (name == 'turtle')
        return 2
      else if (name == 'mindmap')
        return 0
      else if (name == 'recommended')
        return 6
      else
        return 1
    }

    function rlist(page, fun) {
      var size = localStorage['page']
      var cate = localStorage['cate']
      var api = 'https://all-dream.com/rest/share/list'
      start_time = new Date()
      console.log("Grabbing list at " + start_time)
      $$.ajax({
        method: 'POST',
        url: api,
        data: {
          rows: size,
          shareType: mapSid(cate),
          bigType: cate == 'all' ? 3 : 1,
          page: pageNum
        },
        success: function (data) {
          fun(JSON.parse(data));
          end_time = new Date()
          console.log("Finished at " + end_time + " in " + (end_time - start_time) + "ms (size is " + localStorage['page'] + ")")
        }
      });
    }

    $$('#pagnum')[0].onclick = function () {
      var old_num = localStorage['page']
      var ok = function (t, d) {
        var n = Number(t)
        if (n != 0) {
          localStorage['page'] = n
          mdui.snackbar("ä½ è®¾ç½®äº†æ–°æ¯é¡µé¡¹ç›®æ•°ï¼š" + n, { buttonText: 'undo', onButtonClick: function () { localStorage['page'] = old_num } })
        } else { mdui.snackbar("ä¸èƒ½è®¾ç½®ä¸º 0ï¼Œè¯·ä¸è¦å¡«ä¸ºç©º") }
      }
      var cancel = function (t, d) {
        d.close()
      }
      mdui.prompt("è¯·è¾“å…¥æ¯é¡µæ˜¾ç¤ºé¡¹ç›®æ•°ï¼ˆå½“å‰ " + localStorage['page'] + " é¡¹/é¡µï¼‰", ok, cancel, null)
    }

    $$('#title')[0].onclick = function () {
      $$.ajax({
        method: 'POST',
        url: 'https://all-dream.com/rest/share/queryCount',
        success: function (data) {
          var obj = JSON.parse(data)
          mdui.alert("æ€»å…±æœ‰ " + obj['total'] + " ä¸ªä½œå“ï¼Œå…¶ä¸­ Scaratch " + obj['SB2Count'] + " ä¸ªï¼ŒTJS " + obj['JSCount'] + " ä¸ªï¼Œæ€ç»´å¯¼å›¾ " + obj['mindMappingCount'] + "ä¸ªï¼Œæ¨è" + obj['promote'] + " ä¸ª");
        }
      });
    }

    pageNum = 1
    bin = []
    $$('#refresh')[0].onclick = function () {
      bin = []
      var grab_snack = mdui.snackbar("æ­£åœ¨ä»è¿œç«¯è·å–åˆ—è¡¨...")
      // Angry! ä¸ºå•¥æˆ‘ä¸çŸ¥é“æ€ä¹ˆå®šä¹‰å±€éƒ¨å˜é‡
      var start_time2 = new Date()
      rlist(pageNum, function (d) {
        grab_snack.close()
        mdui.snackbar("æˆåŠŸä»è¿œç«¯è·å¾—åˆ—è¡¨ï¼Œç”¨æ—¶ " + (new Date() - start_time2) / 1000 + " ç§’")
        var buf = ""
        for (var k in d['list']) {
          var v = d['list'][k]
          // console.log(v)
          bin[k] = v
          item = fill('https://all-dream.com/' + v['coverUrl'], v['courseTypeName'] + ' - ' + v['name'] + 'ï¼ˆ' + v['grade'] + 'ï¼‰', v['shareTitle'] + ' | â­ï¸ ' + v['star'] + ' ğŸ“ ' + v['score'] + ' ğŸ• ' + new Date(v['createTime']).toString().replace('GMT+0800 (CST)', ''), v['shareContent'], "window.location='https://all-dream.com/'+bin[" + k + "]['fileUrl']", "tmp=bin[" + k + "];download(JSON.stringify(tmp),'json_'+tmp['shareTitle']+'_'+tmp['name'],'application/json')")
          buf += wrap(item)
        }
        setlist(buf)
      });
    }
  </script>

  <script>
    var template = '<div class="mdui-card"><div class="mdui-card-media"><img src="@img@"/></div><div class="mdui-card-primary"><div class="mdui-card-primary-title">@title@</div><div class="mdui-card-primary-subtitle">@subtitle@</div></div><div class="mdui-card-content">@desc@</div><div class="mdui-card-actions"><button onclick="@a1@" class="mdui-btn mdui-ripple mdui-color-theme-accent mdui-btn-raised"><i class="mdui-icon mdui-icon-left material-icons">file_download</i> ä¸‹è½½</button><button onclick="@a2@" class="mdui-btn mdui-btn-raised mdui-ripple"><i class="mdui-icon mdui-icon-left material-icons">info_outline</i> åŸæ•°æ®</button></div></div>'
    function fill(img, title, subt, desc, a1, a2) {
      return template.replace('@img@', img)
        .replace('@title@', title)
        .replace('@subtitle@', subt)
        .replace('@desc@', desc)
        .replace('@a1@', a1)
        .replace('@a2@', a2);
    }
    function setlist(t) {
      list.innerHTML = t
    }
    function wrap(h) {
      return '<div class="mdui-col"><div class="mdui-grid-tile mdui-shadow-5">' + h + '</div></div>'
    }
  </script>

  <!-- Main list -->
  <div class="mdui-container-fluid">
    <div id="list" style="padding: 4px;" class="mdui-row-xs-3 mdui-row-sm-4 mdui-row-md-5 mdui-row-lg-6 mdui-row-xl-7 mdui-grid-list"></div>
  </div>
  <script>var list = $$('#list')[0]</script>

  <button onclick="pageNum++; mdui.snackbar('å‰è¿›ä¸€é¡µï¼š' + pageNum)" class="mdui-fab mdui-fab-fixed mdui-color-theme-accent mdui-ripple">
    <i class="mdui-icon material-icons">arrow_forward</i>
  </button>

  <div class="mdui-dialog" id="set-category">
    <div class="mdui-dialog-title">è¯·é€‰æ‹©è¦æ˜¾ç¤ºçš„åˆ†ç±»</div>
    <div class="mdui-dialog-content">æ‚¨å¯ä»¥é€‰æ‹©åªæ˜¾ç¤ºæŒ‡å®šç±»å‹çš„é¡¹ç›®ï¼ŒåŒ…æ‹¬
      <mark>å…¨éƒ¨ã€MindMapã€Scratchã€JS Turtleã€æ¨è</mark>
    </div>
    <div class="mdui-dialog-actions mdui-dialog-actions-stacked">
      <button onclick="s('all')" class="mdui-btn mdui-ripple" mdui-dialog-confirm="">Show All | æ˜¾ç¤ºå…¨éƒ¨</button>
      <button onclick="s('mindmap')" class="mdui-btn mdui-ripple" mdui-dialog-confirm="">Show Mind-Maps | MindMap</button>
      <button onclick="s('scratch')" class="mdui-btn mdui-ripple" mdui-dialog-confirm="">Show Scratch Projects | Scratch </button>
      <button onclick="s('turtle')" class="mdui-btn mdui-ripple" mdui-dialog-confirm="">Show JS Turtle Projects | JS Turtle</button>
      <button onclick="s('recommended')" class="mdui-btn mdui-ripple" mdui-dialog-confirm="">Recommended Projects | æ¨èé¡¹ç›®</button>
      <button class="mdui-btn mdui-ripple" mdui-dialog-close="">Keep settings, close dialog | ä¿æŒç°çŠ¶</button>
    </div>
  </div>
</body>

</html>
