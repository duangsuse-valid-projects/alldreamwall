<!DOCTYPE html>
<!-- Copyright(C) 2018 duangsuse
alldream.html is a standalone web fortend tool for viewing alldream workshare platform worklist
Licensed under LGPLv3 -->
<html lang="zh-cn" dir="ltr">

<head>
  <title>AllDream å‚²æ¢¦å±•è§ˆå¢™</title>
  <meta charset="utf-8">
  <meta name="description" content="æ¬£èµ 4k+ ä¸ªä¸­å›½å­©å­çš„ç¥å¥‡ä½œå“">
  <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta property="og:site_name" content="å‚²æ¢¦ç¼–ç¨‹ BigWall">
  <meta property="og:title" content="å‚²æ¢¦ç¼–ç¨‹ BigWall">
  <meta property="og:description" content="æ¬£èµ 4k+ ä¸ªå­©å­çš„ç¥å¥‡ä½œå“">
  <meta name="theme-color" content="#2196F3">
  <meta content="index,follow" name="robots">
  <meta content="telphone=no, email=no" name="format-detection">
  <meta name="format-detection" content="telephone=no">
  <link rel="icon" href="https://all-dream.com/favicon.ico">
  <!-- MDUI <3 duangsuse -->
  <link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/mdui/0.4.1/css/mdui.min.css">
  <script src="https://cdnjs.loli.net/ajax/libs/mdui/0.4.1/js/mdui.min.js"></script>
  <!-- Community libraries -->
  <script src="https://cdnjs.loli.net/ajax/libs/downloadjs/1.4.8/download.js"></script>
  <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
  <script>
    var $$ = mdui.JQ;
    localStorage['page'] = localStorage['page'] || 25
    localStorage['cate'] = localStorage['cate'] || 'scratch'
    function s(set) { localStorage['cate'] = set; $$('#title')[0].text = "ä½œå“ç›®å½•" + "ï¼ˆ" + set + "ï¼‰" }
  </script>
  <style>
    .grid-item {
      width: 294px;
    }
  </style>
</head>

<body class="mdui-theme-primary-blue mdui-theme-accent-pink">
  <div mdui-headroom="" class="mdui-appbar">
    <div class="mdui-toolbar mdui-color-theme">
      <a id="title" class="mdui-text-color-white mdui-typo-title" mdui-tooltip="{content: 'æ˜¾ç¤ºä½œå“è®¡æ•°'}">ä½œå“ç›®å½•</a>
      <div class="mdui-toolbar-spacer"></div>
      <a id="go-back" onclick="if (pageNum > 1) { pageNum--; mdui.snackbar('åé€€ä¸€é¡µï¼š' + pageNum, { timeout: 500 }) } else { mdui.snackbar('å·²ç»åˆ°ç¬¬ä¸€é¡µäº†', { timeout: 700 }) }"
        class="mdui-btn mdui-btn-icon" mdui-tooltip="{content: 'åé€€ä¸€é¡µ'}">
        <i class="mdui-text-color-white mdui-icon material-icons">arrow_back</i>
      </a>
      <a id="pagnum" class="mdui-btn mdui-btn-icon" mdui-tooltip="{content: 'æ¯é¡µæ˜¾ç¤ºæ¡æ•°'}">
        <i class="mdui-text-color-white mdui-icon material-icons">featured_play_list</i>
      </a>
      <a id="btn-category" class="mdui-btn mdui-btn-icon" mdui-dialog="{target: '#set-category'}" mdui-tooltip="{content: 'åˆ†ç±»'}">
        <i class="mdui-text-color-white mdui-icon material-icons">folder</i>
      </a>
      <a id="refresh" class="mdui-btn mdui-btn-icon" mdui-tooltip="{content: 'åˆ·æ–°'}">
        <i class="mdui-text-color-white mdui-icon material-icons">refresh</i>
      </a>
    </div>
  </div>

  <script>
    function mapSid(name) {
      if (name == 'scratch')
        return 1
      else if (name == 'turtle')
        return 2
      else if (name == 'mindmap')
        return 0
      else if (name == 'recommended')
        return 6
      else
        return 1
    }
    function getSidLogo(sid) {
      if (sid == '1')
        return 'ğŸ±'
      else if (sid == '2')
        return 'ğŸ¢'
      else if (sid == '0')
        return 'ğŸ¤”'
      else if (sid == '6')
        return 'ğŸŒ '
      else
        return 'â“'
    }
    function tfmt(date) {
      return date.getFullYear() + " å¹´ " + (date.getMonth() + 1) + " æœˆ " + date.getDate() + " " + date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds()
    }
    // should use dark style from 19:00 to 6:00
    function shouldApplyDarkStyle() {
      var conf = localStorage['night']
      if (conf != null) {
        if (conf == false.toString())
          return false;
        else return true;
      }
      var dh = new Date();
      var nightBegin = localStorage['nightBegin'] || 19
      var nightEnd = localStorage['nightEnd'] || 6
      return dh.getHours() >= nightBegin && dh.getHours() <= nightEnd
    }

    MDUI_DARK_CLASS = 'mdui-theme-layout-dark'

    // call this to apply dark style automatically
    function autodark() {
      var body = mdui.JQ('body')[0]
      var cls = body.classList
      if (shouldApplyDarkStyle())
        cls.add(MDUI_DARK_CLASS)
      else
        cls.remove(MDUI_DARK_CLASS)
    }

    function rlist(page, fun) {
      var size = localStorage['page']
      var cate = localStorage['cate']
      var api = 'https://all-dream.com/rest/share/list'
      start_time = new Date()
      console.log("Grabbing list at " + start_time)
      $$.ajax({
        method: 'POST',
        url: api,
        data: {
          rows: size,
          shareType: cate == 'all' ? null : mapSid(cate),
          bigType: cate == 'all' ? 3 : 1,
          page: pageNum
        },
        success: function (data) {
          fun(JSON.parse(data));
          end_time = new Date()
          console.log("Finished at " + end_time + " in " + (end_time - start_time) + "ms (size is " + localStorage['page'] + ")")
        }
      });
    }

    $$('#pagnum')[0].onclick = function () {
      var old_num = localStorage['page']
      pagnum_ok = function (t, d) {
        var n = Number(t)
        if (n != 0 && Number.isNaN(n)) {
          localStorage['page'] = n
          mdui.snackbar("ä½ è®¾ç½®äº†æ–°æ¯é¡µé¡¹ç›®æ•°ï¼š" + n, { buttonText: 'undo', onButtonClick: function () { localStorage['page'] = old_num } })
        } else { mdui.snackbar("ä¸èƒ½è®¾ç½®ä¸º 0ï¼Œè¯·ä¸è¦å¡«ä¸ºç©º") }
      }
      var cancel = function (t, d) {
        d.close()
      }
      diag_pagnum = mdui.prompt("è¯·è¾“å…¥æ¯é¡µæ˜¾ç¤ºé¡¹ç›®æ•°ï¼ˆå½“å‰ " + localStorage['page'] + " é¡¹/é¡µï¼‰", pagnum_ok, cancel, { confirmOnEnter: true })
    }

    $$('#title')[0].onclick = function () {
      $$.ajax({
        method: 'POST',
        url: 'https://all-dream.com/rest/share/queryCount',
        success: function (data) {
          var obj = JSON.parse(data)
          var toolset = "<p><div class=\"mdui-typo\"><h3>æŸ¥è¯¢å°å·¥å…·ï¼š</h3><p>æ ¹æ® <em>UID</em> è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯<p>æ ¹æ® <em>SID</em> è·å–åˆ†äº«ä¿¡æ¯<p>æŸ¥è¯¢å®çŸ³æ¦œ<p>æŸ¥è¯¢é‡‘å¸æ¦œ<p>è¿™æ˜¯ç”± <a href=\"https://t.me/duangsuse\">duangsuse</a> å¼€å‘çš„ <a href=\"https://all-dream.com\">å‚²æ¢¦</a> åˆ†äº«é¡¹ç›®æ•°æ®æŸ¥è¯¢å·¥å…·ï¼Œä»¥ <strong>GNU LGPL-3.0</strong> å…±äº«åè®®å¼€æ”¾æºä»£ç <p><small>æ„Ÿè°¢ <strong>MDUIã€download.jsã€Masonry</strong> æä¾›çš„éƒ¨åˆ†ç‰¹æ€§æ”¯æŒ</small></div>"
          mdui.alert("<a class=\"mdui-typo\">æ€»å…±æœ‰ <code>" + obj['total'] + "</code> ä¸ªä½œå“ï¼Œå…¶ä¸­ Scaratch <code>" + obj['SB2Count'] + "</code> ä¸ªï¼ŒTJS <code>" + obj['JSCount'] + "</code> ä¸ªï¼Œæ€ç»´å¯¼å›¾ <code>" + obj['mindMappingCount'] + "</code> ä¸ªï¼Œæ¨è <code>" + obj['promote'] + "</code> ä¸ª</a>" + toolset);
        }
      });
    }

    pageNum = 1
    bin = []
    $$('#refresh')[0].onclick = function () {
      bin = []
      var grab_snack = mdui.snackbar("æ­£åœ¨ä»è¿œç«¯è·å–åˆ—è¡¨...")
      // Angry! ä¸ºå•¥æˆ‘ä¸çŸ¥é“æ€ä¹ˆå®šä¹‰å±€éƒ¨å˜é‡
      var start_time2 = new Date()
      rlist(pageNum, function (d) {
        grab_snack.close()
        mdui.snackbar("æˆåŠŸä»è¿œç«¯è·å¾—åˆ—è¡¨ï¼Œç”¨æ—¶ " + (new Date() - start_time2) / 1000 + " ç§’")
        var buf = ""
        for (var k in d['list']) {
          var v = d['list'][k]
          // console.log(v)
          bin[k] = v
          item = fill('https://all-dream.com/' + v['coverUrl'], v['courseTypeName'] == null ? 'æ— è¯¾ç¨‹åˆ†ç±»' : v['courseTypeName'] + ' - ' + v['name'] + 'ï¼ˆ' + v['grade'] + 'ï¼‰', v['shareTitle'] + ' | â­ï¸ ' + v['star'] + ' ğŸ“ ' + v['score'] + ' ğŸ• ' + tfmt(new Date(v['createTime'])) + ' ğŸ‘ ' + v['visit'] + ' ğŸ’ ' + v['gold'] + ' | ' + (v['promote'] == 1 ? 'ğŸ‘' : '') + (v['sex'] == '1' ? 'ğŸ‘¦ğŸ»' : 'ğŸ‘§ğŸ»') + getSidLogo(v['shareType']), v['shareContent'], "window.location='https://all-dream.com/'+bin[" + k + "]['fileUrl']", "tmp=bin[" + k + "];download(JSON.stringify(tmp),'json_'+tmp['shareTitle']+'_'+tmp['name'],'application/json')")
          buf += wrap(item)
        }
        setlist(buf);
        $$.showOverlay();
        $$.throttle(function () { refresh_mash(); $$.hideOverlay(); }, 1000)();
      });
      autodark();
    }

    // auto apply dark style
    autodark();

    // hotkeys
    function do_refresh() { $$('#refresh').trigger('click') }
    document.onkeyup = function (k) {
      // Enter to refresh
      if (k.code == 'Enter') {
        if (k.target == $$('body')[0]) {
          do_refresh();
        } else {
          if (typeof diag_pagnum != 'undefined') {
            // deprecated
            // diag_pagnum.close();
            // pagnum_ok();
          }
        }
      }

      // console.log(k.code);
      switch (k.code) {
        case 'KeyM':
          $$('#title').trigger('click');
          break
        case 'ArrowRight':
          $$('.mdui-fab').trigger('click');
          break
        case 'ArrowLeft':
          $$('#go-back').trigger('click');
          break
        case 'KeyC':
          $$('#btn-category').trigger('click');
          break
        case 'KeyT':
          $$('#pagnum').trigger('click');
      }
    }
  </script>

  <script>
    var template = '<div class="mdui-card"><div class="mdui-card-media"><img src="@img@"/></div><div class="mdui-card-primary"><div class="mdui-card-primary-title">@title@</div><div class="mdui-card-primary-subtitle">@subtitle@</div></div><div class="mdui-card-content">@desc@</div><div class="mdui-card-actions"><button onclick="@a1@" class="mdui-btn mdui-ripple mdui-color-theme-accent mdui-btn-raised"><i class="mdui-icon mdui-icon-left material-icons">file_download</i> ä¸‹è½½</button><button onclick="@a2@" class="mdui-btn mdui-btn-raised mdui-ripple"><i class="mdui-icon mdui-icon-left material-icons">info_outline</i> æºæ•°æ®</button></div></div>'
    function fill(img, title, subt, desc, a1, a2) {
      return template.replace('@img@', img)
        .replace('@title@', title)
        .replace('@subtitle@', subt)
        .replace('@desc@', desc)
        .replace('@a1@', a1)
        .replace('@a2@', a2);
    }
    function setlist(t) {
      list.innerHTML = t
    }
    function wrap(h) {
      return '<div class="grid-item mdui-shadow-5 mdui-grid-tile mdui-grid-list">' + h + '</div>'
    }
  </script>

  <!-- Main list -->
  <div id="list" style="padding: 10px;" class="grid mdui-container-fluid"></div>
  <script>var list = $$('#list')[0]</script>
  <script>
    function refresh_mash() {
      var msnry = new Masonry(list, {
        itemSelector: '.grid-item',
        columnWidth: 30
      });
    }
  </script>

  <button onclick="pageNum++; mdui.snackbar('å‰è¿›ä¸€é¡µï¼š' + pageNum, { timeout: 500 })" class="mdui-fab mdui-fab-fixed mdui-color-theme-accent mdui-ripple">
    <i class="mdui-icon material-icons">arrow_forward</i>
  </button>

  <div class="mdui-dialog" id="set-category">
    <div class="mdui-dialog-title">è¯·é€‰æ‹©è¦æ˜¾ç¤ºçš„åˆ†ç±»</div>
    <div class="mdui-dialog-content mdui-typo">æ‚¨å¯ä»¥é€‰æ‹©åªæ˜¾ç¤ºæŒ‡å®šç±»å‹çš„é¡¹ç›®ï¼ŒåŒ…æ‹¬
      <code>å…¨éƒ¨ã€MindMapã€Scratchã€JS Turtleã€æ¨è</code>
    </div>
    <div class="mdui-dialog-actions mdui-dialog-actions-stacked">
      <button onclick="s('all')" class="mdui-btn mdui-ripple" mdui-dialog-confirm="">Show All | æ˜¾ç¤ºå…¨éƒ¨</button>
      <button onclick="s('mindmap')" class="mdui-btn mdui-ripple" mdui-dialog-confirm="">Show Mind-Maps | MindMap</button>
      <button onclick="s('scratch')" class="mdui-btn mdui-ripple" mdui-dialog-confirm="">Show Scratch Projects | Scratch </button>
      <button onclick="s('turtle')" class="mdui-btn mdui-ripple" mdui-dialog-confirm="">Show JS Turtle Projects | JS Turtle</button>
      <button onclick="s('recommended')" class="mdui-btn mdui-ripple" mdui-dialog-confirm="">Recommended Projects | æ¨èé¡¹ç›®</button>
      <button class="mdui-btn mdui-ripple" mdui-dialog-close="">Keep settings, close dialog | ä¿æŒç°çŠ¶</button>
    </div>
  </div>
</body>

</html>
